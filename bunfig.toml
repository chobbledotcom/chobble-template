[test]
preload = ["./test/ensure-deps.js", "./test/setup.js"]

# Test file patterns
root = "./test"

# Parallel execution (default behavior in Bun)
# Bun automatically runs tests in parallel

# Timeout for individual tests (30 seconds)
timeout = 30000

# Always enable coverage reporting
coverage = true

# Coverage thresholds - tests fail if coverage drops below these levels
# Allows manual management of .coverage_exceptions.json while preventing regressions
# Full 100% coverage required for both lines and functions
coverageThreshold = { lines = 1.0, functions = 1.0 }

# Files excluded from coverage:
# - ensure-deps.js: defensive code that can't be meaningfully tested
# - validated-config.js: module-load-time validation that can only fail if config files are misconfigured
# - customise-cms/*: CLI scripts with hard-to-test file system operations
# - cli-io.js: I/O functions that read process.argv and call process.exit
# - pdf.js, image.js, image-crop.js, image-external.js: error handling for external library edge cases
# - console.js: console output utilities
# - test-runner-utils.js, test-utils.js: test infrastructure
# - recurring-events.js: date edge cases
# - cart-utils.js, quote-price-utils.js: browser-specific edge cases
# - array-utils.js: some utility functions only used in specific contexts
# - on-ready.js: document.readyState branch requires complex mocking
# - search.js: dynamic import("/pagefind/pagefind.js") only resolves against built site
# - screenshot.js, screenshots.js, lighthouse.js, browser-utils.js: Playwright/Chrome browser automation
# - configure-filters.js: Eleventy registration wiring (functions it calls are fully tested)
coveragePathIgnorePatterns = [
  ".cache/*",
  "src/_lib/filters/configure-filters.js",
  "test/ensure-deps.js",
  "src/_lib/config/validated-config.js",
  "src/_lib/public/utils/on-ready.js",
  "src/_lib/public/ui/category-filter.js",
  "src/_lib/public/ui/search.js",
  "scripts/customise-cms/cli-io.js",
  "scripts/customise-cms/config.js",
  "scripts/customise-cms/fields.js",
  "scripts/customise-cms/generator.js",
  "src/_lib/eleventy/pdf.js",
  "src/_lib/eleventy/recurring-events.js",
  "src/_lib/media/image.js",
  "src/_lib/media/image-crop.js",
  "src/_lib/media/image-external.js",
  "src/_lib/public/utils/cart-utils.js",
  "src/_lib/public/utils/notify.js",
  "src/_lib/utils/format-price.js",
  "src/_lib/public/utils/quote-price-utils.js",
  "src/_lib/utils/console.js",
  "test/test-runner-utils.js",
  "test/test-utils.js",
  "src/_lib/eleventy/screenshots.js",
  "src/_lib/media/screenshot.js",
  "src/_lib/media/browser-utils.js",
  "src/_lib/media/lighthouse.js",
]
