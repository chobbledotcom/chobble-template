[test]
preload = ["./test/ensure-deps.js", "./test/setup.js"]

# Test file patterns
root = "./test"

# Parallel execution (default behavior in Bun)
# Bun automatically runs tests in parallel

# Timeout for individual tests (30 seconds)
timeout = 30000

# Always enable coverage reporting
coverage = true

# Coverage thresholds - tests fail if coverage drops below these levels
# Allows manual management of .coverage_exceptions.json while preventing regressions
coverageThreshold = { lines = 1.0, functions = 1.0 }

# Files excluded from coverage:
# - ensure-deps.js: defensive code that can't be meaningfully tested
# - canonical-url.js: module-load-time validation guards that can only fail if site.json is misconfigured
# - customise-cms/*: CLI scripts with hard-to-test file system operations
# - pdf.js, image.js, image-crop.js: error handling for external library edge cases
# - console.js: console output utilities
# - test-runner-utils.js, test-utils.js: test infrastructure
# - recurring-events.js: date edge cases
# - cart/quote utilities: browser-specific edge cases
# - array-utils.js: some utility functions only used in specific contexts
# - on-ready.js: document.readyState branch requires complex mocking
coveragePathIgnorePatterns = [
  "test/ensure-deps.js",
  "src/_lib/utils/canonical-url.js",
  "src/_lib/public/utils/on-ready.js",
  "scripts/customise-cms/config.js",
  "scripts/customise-cms/fields.js",
  "scripts/customise-cms/generator.js",
  "src/_lib/eleventy/pdf.js",
  "src/_lib/eleventy/recurring-events.js",
  "src/_lib/media/image.js",
  "src/_lib/media/image-crop.js",
  "src/_lib/public/cart/quote-steps.js",
  "src/_lib/public/utils/cart-utils.js",
  "src/_lib/public/utils/quote-price-utils.js",
  "src/_lib/utils/array-utils.js",
  "src/_lib/utils/console.js",
  "test/test-runner-utils.js",
  "test/test-utils.js",
]
