[test]
preload = ["./test/ensure-deps.js", "./test/setup.js"]

# Exclude infrastructure scripts from coverage (defensive code that can't be meaningfully tested)
coveragePathIgnorePatterns = ["test/ensure-deps.js"]

# Test file patterns
root = "./test"

# Parallel execution (default behavior in Bun)
# Bun automatically runs tests in parallel

# Timeout for individual tests (30 seconds)
timeout = 30000

# Always enable coverage reporting
coverage = true

# Coverage thresholds - tests fail if coverage drops below these levels
# Allows manual management of .coverage_exceptions.json while preventing regressions
coverageThreshold = { lines = 0.983, functions = 0.986, statements = 0.983 }

# Files excluded from coverage
# canonical-url.js has module-load-time validation guards that can only fail
# if site.json is misconfigured - these are untestable startup assertions
coveragePathIgnorePatterns = ["src/_lib/utils/canonical-url.js"]
